
          'ItsyBitsy M0 Synth' / 'Sigma-6 Voice Module' (SAMD21 MCU)

                         Firmware Revision History

================================================================================

v1.0  20-01-2025
````````````````
Minimal functionality... No OLED user-interface, no CV control. 
Sound engine tested OK. MIDI control tested OK.

v1.1  xx-01-2025 -- WIP (not released)
````````````````
Added patch presets...  total: 24
Imported improvements done in full-featured Sigma-6 (PIC32MX).

v1.2  13-02-2025
````````````````
Added code module to support control panel (UI with OLED, etc).
Added MIDI Control Change message types for config & patch params).
Added functions to support CV control mode.
Added 'SETUP MENU' screen to select param to adjust...(cool feature!)
Added many more UI screen functions (param settings).
Added CV option to quantize (or not) pitch to nearest semitone.
Added Master Tune parameter and GUI screen function to adjust.

v1.3  15-02-2025
````````````````
Fixed bug in 'ENV Decay' setup screen... data shown incorrectly.
Fixed bug in 'Reverb' setup screen.... 'Cancel' malfunction.
Fixed bug in 'Master Tune' setup screen... 'Cancel' malfunction.

Added feature: Display brightness is adjustable using pot in 'Home' screen.

v1.4  25-02-2025  (= v1.3R)
````````````````
Added macro in header file "M0-synth-defs.h" (line 13) to compile for either
Adafruit M0 or (RoboDyn) SAMD21-M0-Mini board.  This is necessary because
the SAMD21-M0-Mini board is not 100% I/O compatible with the Adafruit M0.

v1.5  28-02-2025
````````````````
Modified 'control mode' to switch automatically between MIDI and CV input...
Mode is initialized at power-on/reset according to jumper JP1 setting;
if MIDI 'Note-On' message rec'd, control mode switches to MIDI;
if GATE input transitions from Low to High, mode switches to CV.

Reduced filter time-constant on CV1 input signal to speed up response to
changes in pitch. (Not fully tested yet.)

Added MIDI message support for Master Tune and Ampld Envelope (ENV1) param's.

Added UI screen to allow 'CV Base Note' setting, range 24 (C1) to 55 (G3),
accessible via 'CV Options' in SETUP menu. (Also settable via MIDI msg.)

Minor cosmetic changes to a few UI screens.

v1.6  07-03-2025
````````````````
Modified CV1 CAL screen to show both uncalibrated reading (using 5100mV FS) and 
adjusted reading (using config param).  If correctly calibrated, the adjusted
reading will equal the reference voltage applied to the CV1 input (±5 mV).

Improved Preset 01: "Electric Piano #1".  Added presets 25..28.

Fixed a bug in Reverb UI setting... (need to re-calculate variables).


v1.7  12-03-2025 -- WIP
```````````````````````
Fixed a bug in CV Mode (?) -- Delayed (or no) response to GATE signal.

Added support for 24LC08 EEPROM to store config data. <!> NOT TESTED <!>
Start-up screen shows a warning message if EEPROM is faulty or not fitted.

Added "auto-detect" function for OLED display.  
No need to tie button inputs to GND where OLED is not fitted.

v1.7.2  13-03-2025 -- WIP
`````````````````````````
Fixed a bug in EEPROM driver code -- But still more bug(s) in it!

Added option to use CV3 (EXPRN) input for "Velocity" when 'Ampld Ctrl Mode'
is set to 'ENV1 * Velo'. (Otherwise, velocity is constant 80% FS.)

v1.8  14-03-2025 -- WIP
`````````````````````````
Cosmetic changes to Home screen... icons, logos, etc.
Non-functional changes to Start-up screen (text).

All Setup Menu selections are available in any control mode (CV or MIDI).

v1.9  20-03-2025
````````````````
EEPROM driver code fixed. (Verified by JPM.)

v1.9.6  23-APR-2025 : Released on GitHub
````````````````````````````````````````
Fixed bug in MIDI input routine: Data Entry (Master Tune) message must be
preceded by Registered Param (01) message; else Data Entry msg ignored.


v2.0  30-MAY-2025 : Released on GitHub
``````````````````````````````````````
Added GATE signal 'de-bounce' function in case GATE input source is a manual 
push-button or other mechanical switch (with adverse contact bounce).

Changed 'Master Tune' param range, now -100 to +100 cents (+1/-1 semitone)
using control panel.  (MIDI range remains ±64 due to 7-bit data range.) 

Added feature to switch 'Legato Mode' ON or OFF via MIDI message CC68.
Added icon (^) to show 'Legato Mode' status in SETUP MENU screen (top LHS).
Presets 01 ~ 23 have Legato disabled when selected.
Presets 24 ~ 31 have Legato enabled when selected (to suit EWI controllers).

Modified MIDI input service routine. When Legato is OFF, the synth operates
in "Multi-Trigger" keying mode (to suit Polyphonic MIDI controllers).
[See project website for details.]

Modulation level is set at 50% whenever a preset is selected, in case there's 
no signal input (MIDI or CV) to vary the level while a note is playing.

Added configuration parameter 'CV Auto-switch' (value ON or OFF).
The parameter can be set ON or OFF in the Setup screen 'CV Options'.
If it is set 'ON', CV control mode will switch automatically between MIDI
and CV control when a MIDI Note-On msg or GATE signal is input (resp.).
If it is set 'OFF', CV control is disabled, allowing MIDI control only.

Modified CV input service routine. CV1 ADC readings are filtered (1st-order
IIR with K = 1/16) which caused a delay, hence unwanted 'glissando'.
The filter output variable is now reset to the instantaneous ADC reading every
time the GATE signal transitions from Low to High, to eliminate the annoying
glide from the last note playing to the new note.

Modified Start-up screen: 'Default' option (button B) not shown if EEPROM is 
faulty or not installed.
Added a firmware build option: #define EEPROM_IS_INSTALLED  {TRUE or FALSE}
Set this symbol FALSE if EEPROM is not installed so that the error message
'<!> EEPROM fault' does not appear on the Startup screen.  Instead, a warning
message 'No EEPROM support' will be displayed.

Refined instrument sounds in some presets. Total presets: 32.

v2.1  31-MAY-2025 : (wip)	
`````````````````````````
Swapped presets 14 and 29.  #29 is now 'Melody Organ #2' to suit EWI usage.

v2.2  01-SEP-2025
`````````````````
Fixed: ADC readings preceded by a "dummy" read. (1st unreliable - discarded)

Fixed: MIDI CC73: Set ENV Attack Time -- data unit is 10ms (not 100ms).
Fixed: MIDI CC74: Set ENV Peak-Hold Time -- data unit is 10ms (not 100ms).

Added MIDI messages CC100 and CC38 to set pitch bend range and fine tuning.

Added MIDI message type CC80 to set Osc. Mixer levels.
Data byte MSD = Osc number (0..5), LSD = Step value (0..15).

Added LED drive on pin D5 = active (high) when note playing (gated).

Modified PITCH BEND setup screen to show bend range and mode (on/off).
If bend range is set to 0, pitch bend is disabled (mode = OFF).

Modified PRESETS (select) screen to group Presets into banks of 16 each.
Button A advances selection to next bank.

Revised all code files to use Arduino data types (uint8_t, uint16_t, etc).


v2.4  24-OCT-2025
`````````````````
Revised file: m0_synth_def.h -- Unified for all Sigma-6 SAMD21 variants.
Modified conditional compile directives accordingly.

Recommended to select board type "Arduino Zero (Native USB)" in Arduino IDE,
for hardware variants using Robotdyn SAMD21 M0-Mini board, because the core 
start-up code utilizes the 32.768kHz crystal for the MCU system clock.
NB: The Adafruit M0 Express does not have a crystal!


v2.5  07-JAN-2025
`````````````````
Added UI screen to set Keying Mode: Multi-trigger/Legato.
The 'CV Options' screen is now accessible only via the 'Keying Mode' screen;
it is not directly accessible from the 'Setup menu' screen.

Legato mode is recommended for CV/gate operation and Monophonic MIDI controller
operation (including EWI controllers). Multi-trigger mode is recommended for
polyphonic MIDI controllers (keyboard, sequencer, etc).

Refined preset/patch 31 "Deep Saxophoney".  Copied to Poly-Voice source file.


v2.6  17-JAN-2025
`````````````````
Added UI screen to select MIDI channel which over-rides DIP switch setting.
Channel defaults to DIP switch setting if EEPROM not fitted or data corrupted, 
or if the OLED display is not fitted or not functioning.

The 'Keying Mode' and 'CV Options' screens are now accessible directly
from the 'SETUP' menu screen.  The 'CV Base Note' setting screen is
still only accessible via the 'CV Options' screen -- Press [Next] button.

Fixed some minor bugs, e.g:
  -> Wrong bank displayed in 'Select Preset' screen (sometimes);
  -> Wrong info displayed in 'Startup' screen if EEPROM faulty or missing.


v2.7  31-JAN-2025
`````````````````
Fixed bug:  Config param's not defaulted on start-up if EEPROM not fitted.

Removed temporary debug info (CV1 ADC reading) from Home screen!

Minor changes to Startup screen, e.g. 'CV1 CAL' function always accessible.


v2.8  02-FEB-2026
`````````````````
Fixed bug in Contour EG:  Added inverse output signal.

Added "auto-detect" to set keying mode and audio amplitude control mode...
These settings are initialized to persistent config. parameters on start-up.
If a MIDI Breath Pressure message (CC02) is received, the keying mode is set
to "Legato" and the audio ampld control mode is set to "Breath Control" (CC2).

Replaced preset #10 with "Keith Emerson Organ" (was "Rock Organ #3).
Modified preset #19 "Bellbird" -- now "Bellbird Recall".

Added 32 more presets... banks 3 & 4... for further experimentation.
See project web page for explanation of nomenclature.

v2.9  26-FEB-2026
`````````````````
Revised MIDI input service routine. No functional change. Tested OK.

Modified CV mode operation as follows:
If the CV option "Quantize Pitch" is enabled AND the Keying Mode is set to
"Multi-trigger", the CV1 input signal will be sampled once only, 5ms after the
GATE signal leading edge. The oscillator pitch will remain constant until the
next GATE leading edge, except that vibrato (LFO FM) will function as usual.


v3.0  02-MAR-2026
`````````````````
Added UI screen function to set Oscillator Mix levels.
Hit button A to exit the 'Mixer Levels' screen.
Hit button B to advance to the next oscillator for setting.
Use the data entry pot to adjust the level of the selected oscillator.



________________________________________________________________________________

ItsyBitsy_M0_Synth_RevisionHistory.txt                           www.mjbauer.biz  
